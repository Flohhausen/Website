<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Freunde & Chat</title>
<style>
body{font-family:Arial;margin:0;background:#f4f6f8;color:#333;}
header{background:#1E88E5;color:white;text-align:center;padding:25px;font-size:28px;position:relative;}
.container{display:flex;flex-wrap:wrap;padding:20px;justify-content:center;}
.section{background:white;padding:20px;border-radius:10px;width:350px;margin:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
input, select{width:100%;padding:8px;margin:5px 0;border-radius:5px;border:1px solid #ccc;}
button{padding:8px 12px;border:none;border-radius:5px;cursor:pointer;background:#1E88E5;color:white;font-weight:bold;transition:0.2s;margin:3px 0;}
button:hover{background:#1565C0;}
.friend-item{display:flex;justify-content:space-between;align-items:center;background:#f1f3f4;padding:8px 10px;margin-bottom:5px;border-radius:5px;}
.chat-box{background:#e3f2fd;height:300px;overflow-y:auto;padding:10px;margin-bottom:5px;border-radius:5px;}
</style>
</head>
<body>

<header>Freunde & Chat
<button style="position:absolute; top:10px; right:10px;" onclick="goHome()">Home</button>
</header>

<div class="container">

<div class="section">
<h2>Freunde</h2>
<div id="friendList"></div>
<input type="text" id="addFriendInput" placeholder="Benutzername hinzufügen">
<button onclick="addFriend()">Hinzufügen</button>
</div>

<div class="section">
<h2>Handel</h2>
<input type="text" id="tradeUser" placeholder="Benutzername">
<input type="number" id="tradeAmount" placeholder="Coins senden">
<button onclick="sendCoins()">Senden</button>
</div>

<div class="section">
<h2>Chat</h2>
<div class="chat-box" id="chatBox"></div>
<input type="text" id="chatMessage" placeholder="Nachricht eingeben">
<button onclick="sendMessage()">Senden</button>
</div>

</div>

<script>
const username=localStorage.getItem("user");
if(!username){ window.location.href="home.html"; }

function loadFriends(){
    const users=JSON.parse(localStorage.getItem("users"))||[];
    const me=users.find(u=>u.username===username);
    const container=document.getElementById("friendList");
    container.innerHTML="";
    me.friends.forEach(f=>{
        const div=document.createElement("div");
        div.className="friend-item";
        div.textContent=f;
        container.appendChild(div);
    });
}

function addFriend(){
    const friend=document.getElementById("addFriendInput").value.trim();
    const users=JSON.parse(localStorage.getItem("users"));
    const meIndex=users.findIndex(u=>u.username===username);
    if(friend===username){ alert("Du kannst dich nicht selbst hinzufügen"); return; }
    if(!users.find(u=>u.username===friend)){ alert("Benutzer nicht gefunden"); return; }
    if(users[meIndex].friends.includes(friend)){ alert("Schon Freund"); return; }
    users[meIndex].friends.push(friend);
    localStorage.setItem("users",JSON.stringify(users));
    document.getElementById("addFriendInput").value="";
    loadFriends();
}

function sendCoins(){
    const target=document.getElementById("tradeUser").value.trim();
    const amt=parseInt(document.getElementById("tradeAmount").value);
    const users=JSON.parse(localStorage.getItem("users"));
    const meIndex=users.findIndex(u=>u.username===username);
    const tIndex=users.findIndex(u=>u.username===target);
    if(tIndex<0){ alert("Benutzer nicht gefunden"); return; }
    if(users[meIndex].coins<amt){ alert("Nicht genug Coins"); return; }
    users[meIndex].coins-=amt;
    users[tIndex].coins+=amt;
    localStorage.setItem("users",JSON.stringify(users));
    document.getElementById("tradeUser").value="";
    document.getElementById("tradeAmount").value="";
    alert("Coins gesendet!");
}

if(!localStorage.getItem("chatMessages")) localStorage.setItem("chatMessages",JSON.stringify([]));

function loadChat(){
    const messages=JSON.parse(localStorage.getItem("chatMessages"));
    const box=document.getElementById("chatBox");
    box.innerHTML="";
    messages.forEach(m=>{
        const div=document.createElement("div");
        div.textContent=`[${m.user}] ${m.msg}`;
        box.appendChild(div);
    });
    box.scrollTop=box.scrollHeight;
}

function sendMessage(){
    const msg=document.getElementById("chatMessage").value.trim();
    if(!msg) return;
    const messages=JSON.parse(localStorage.getItem("chatMessages"));
    messages.push({user:username,msg:msg});
    localStorage.setItem("chatMessages",JSON.stringify(messages));
    document.getElementById("chatMessage").value="";
    loadChat();
}

function goHome(){ window.location.href="home.html"; }

loadFriends();
loadChat();
</script>
</body>
</html>
